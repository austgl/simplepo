<html>
  <head>
    <title>Simple PO - Choose Catalogue</title>
    <link rel="stylesheet" href="incl/css/master.css" type="text/css" media="screen" title="no title" charset="utf-8">
    <link rel="stylesheet" href="incl/css/index.css" type="text/css" media="screen" title="no title" charset="utf-8">
    <script src="incl/js/jquery-1.3.1.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="incl/js/json2.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">

      $.messageService = function(method, params, callback, error_handler){
        $.post("message_service.php",
        {
          request:JSON.stringify({"method":method, "params":params, "id":Math.random()})
        }, function(obj){
          if (obj.error){
            error_handler ? error_handler(obj.error) : $('#errors').text(obj.error.message);
          } else{
            callback(obj.result);
          }
        }, "json");
      };

      $(document).ready( function(){
        var $container = $('#catalogue_list');
        $.messageService("getCatalogues", [], function(data){
          
          for (var i = 0; i<data.length; ++i){
            var $row = $('<li><a href="edit.html?cat_id='+data[i].id+'">' + data[i].name + '</a> '
                              + ' <div class="progressbar"><div class="inner"></div></div> <span class="percent" /> - <span class="translated" /> of <span class="total" /></li>');
            $container.append($row);
            $row.find('.inner')
              .css( 'width',
                parseInt( $row.find('.progressbar').width() * ( data[i].translated_count / data[i].message_count) )
              );
            $row.find('.translated').text(data[i].translated_count);
            $row.find('.total').text(data[i].message_count);
            $row.find('.percent').text(parseInt(data[i].translated_count / data[i].message_count *100) + " %");
            console.log($row.find('.progressbar').width() * ( data[i].translated_count / data[i].message_count))
          }
        });
      });
    </script>
  </head>

  <body><center>
    <div id="cat_box">
      <div class="block">
        <h3><a href="#">Choose from the following Catalogues:</a></h3>
        <div class="data">
          <ul id="catalogue_list"></ul>
        </div>
      </div>
    </div>
  </center></body>
</html>